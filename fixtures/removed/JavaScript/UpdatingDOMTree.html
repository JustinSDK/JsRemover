<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html dir="ltr" lang="en">
  <head>
    <title>Updating the DOM Tree</title>
    <meta content="caterpillar" name="author">
    <meta content="JavaScript innerHTML appendChild createDocumentFragment DocumentFragment"
      name="keywords">
    <link href="css/std.css" rel="stylesheet" type="text/css">
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
  </head>
  <body>
    <div class="header">
      <div class="hgroup">
        <h3><a href="http://openhome.cc/eGossip/">From eGossip@Openhome</a></h3>
        <h1><a href="index.html">JavaScript Essence: Updating the DOM Tree<br>
          </a></h1>
      </div>
    </div>
    <div class="article">
      <div style="text-align: right;"><a href="../../Gossip/JavaScript/ModifyNodes.html">中文</a></div>
      <br>
      After parsing HTML, all created DOM elements will form a tree structure. Browsers will render all elements according to this tree. Once the DOM tree is changed, browser rendering changes simultaneously. This is the base of dynamically modifying a document. <br>
      <br>
      The following example shows how to add and delete images dynamically. <br>
      <ul>
        <li><a href="samples/UpdatingDOMTree-1.html">UpdatingDOMTree-1.html</a></li>
      </ul>
      <pre>&lt;html&gt;
    &lt;head&gt;
        &lt;meta content="text/html; charset=UTF-8" http-equiv="content-type"&gt;
        &lt;script type="text/javascript"&gt;
            window.onload = function() {
            
                document.getElementById('add').onclick = function() {
                    var images = document.getElementById('images');
                    
                    var img = document.createElement('img');
                    img.src = document.getElementById('src').value;
                    img.onclick = function() {
                        images.removeChild(this);
                    };
                    
                    images.appendChild(img);
                };
            };
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;input id="src" type="text"&gt;&lt;button id="add"&gt;Add&lt;/button&gt;
        &lt;div id="images"&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>
      <br>
      There's no <span class="courier">img</span> tag in this document. After entering an image URL in the <span>input</span> box and pressing Add button, <span
        class="courier">document.creatElement</span> will create an <span
        class="courier">img</span> element dynamically. The element hasn't been appended to the DOM tree, so it doesn't appear on the page yet. You assign the <span
        class="courier">src</span> property the entered URL and the <span
        class="courier">onclick</span> event a function called when the image is clicked. The function will use the <span
        class="courier">removeChild</span> function of <span class="courier">images</span> (the <span
        class="courier">div</span> element with an <span class="courier">id</span> attributes) to remove <span
        class="courier">this</span> image. Finally, <span class="courier">images</span> uses <span
        class="courier">appendChild</span> to append the <span class="courier">img</span> element. Browsers render the page according to the new DOM tree now. <br>
      <br>
      After JavaScript changes the DOM tree, however, you cannot see the modified HTML in the "View Source" window of browsers. The "View Source" window only shows the loaded static HTML. You have to use a tool, such as a DOM Inspector, to observe the dynamically-modified elements. For example, The Elements tab of Chrome Developer Tools is shown as follow: <br>
      <img alt="The Elements tab of Chrome Developer Tools" src="images/UpdatingDOMTree-1.PNG"><br>
      <br>
      A node can only have one parent node. Using <span class="courier">appendChild</span> to append an existing node on the DOM tree means the node will depart from its original parent node and be appended to the new one. For example:<br>
      <ul>
        <li><a href="samples/UpdatingDOMTree-2.html">UpdatingDOMTree-2.html</a></li>
      </ul>
      <pre>&lt;html&gt;
    &lt;head&gt;
        &lt;meta content="text/html; charset=UTF-8" http-equiv="content-type"&gt;
        &lt;script type="text/javascript"&gt;
            window.onload = function() {
                document.getElementById('image').onclick = function() {
                    var container1 = document.getElementById('container1');
                    var container2 = document.getElementById('container2');
                    if(this.parentNode === container1) {
                        container2.appendChild(this);
                    }
                    else {
                        container1.appendChild(this);
                    }
                };
            };
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        Container 1: &lt;div id="container1"&gt;
        &lt;img id="image" src=
      "http://openhome.cc/Gossip/images/caterpillar_small.jpg"/&gt;
                &lt;/div&gt;&lt;br&gt;
        Container 2: &lt;div id="container2"&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>
      <br>
      In this example, the two <span class="courier">div</span> elements will append the <span
        class="courier">img</span> element alternately when it's clicked. Because a node can own only one parent node, <span
        class="courier">appendChild </span>will depart the appended element from the original parent node. <br>
      <br>
      The <span class="courier">createElement</span> function is used to create an element corresponding with the specified tag. Creating a text node, however, needs the <span
        class="courier">createTextNode </span>function. A rarely-used<span
        class="courier"> createAttribute</span> function is used to create an attribute. For example, appending text in <span
        class="courier">&lt;div id="console"&gt;&lt;/div&gt;</span> may use following code: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>var text = document.createTextNode('your text ....');</strong></span><span><strong></strong></span><span><br>
        </span><span><strong></strong></span><span><strong>document.getElementById('console').appendChild(text);</strong></span><span><br>
        </span></div>
      <br>
      You can also use <span class="courier">insertBefore</span> or <span
        class="courier">replaceChild</span> function to update a DOM tree. Take a look at <a
        href="http://www.w3schools.com/dom/dom_document.asp">DOM Document</a> for details. <br>
      <br>
      Note that browsers will re-render the page once a node is appended to the DOM tree. Frequently creating and appending nodes to the DOM tree will cause performance problems. It's recommended to organize a tree fragment in the background. Once the fragment is prepared, append its root node to the DOM tree. This way gets better performance. <br>
      <br>
      The <span class="courier">createDocumentFragment</span> function can be used to create a <span
        class="courier">DocumentFragment</span> instance. You can use it to organize a tree fragment and then append the <span
        class="courier">DocumentFragment</span> instance to the DOM tree. <br>
      <br>
      DOM elements have a non-standard <span class="courier">innerHTML</span> property used to return the contained HTML of an element. You can assign it a HTML string. Browsers will parse it and create corresponding elements. Modern browsers almost support it though it's not a standard property. In fact, HTML 5 accepts <span
        class="courier">innerHTML</span> as a standard property. For example, creating <span
        class="courier">"&lt;b&gt;Hello&lt;/b&gt;"</span> in a <span class="courier">div</span> tag can be as follow: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>document.getElementById('console').innerHTML = '&lt;b&gt;Hello&lt;/b&gt;';</strong></span></div>
      <br>
      Note that Internet Explorer miraculously doesn't support the <span
        class="courier">innerHTML</span> assignment of the <span class="courier">select</span> element.<br>
      <br>
      <br>
      <p></p>
      <p></p>
      <ul>
      </ul>
    </div>
    <div class="aside">
      
       <br>
      <br>
      
       <br>
      <br>
      
       <br>
      <br>
      <br>
    </div>
      </body>
</html>
