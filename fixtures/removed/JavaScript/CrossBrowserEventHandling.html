<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html dir="ltr" lang="en">
  <head>
    <title>Cross-Browser Event Handling</title>
    <meta content="caterpillar" name="author">
    <meta content="JavaScript" name="keywords">
    <link href="css/std.css" rel="stylesheet" type="text/css">
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
  </head>
  <body>
    <div class="header">
      <div class="hgroup">
        <h3><a href="http://openhome.cc/eGossip/">From eGossip@Openhome</a></h3>
        <h1><a href="index.html">JavaScript Essence: Cross-Browser Event Handling<br>
          </a></h1>
      </div>
    </div>
    <div class="article">
      <div style="text-align: right;"><a href="../../Gossip/JavaScript/BrowserIndependentEvent.html">中文</a></div>
      <br>
      Relatively speaking, <a href="BasicEventModel.html">Basic Event Model</a> is more independent of browsers but less flexible than those advanced event models. For example, you cannot register multiple event handlers. Though advanced event models - <a
        href="DOMLevel2EventModel.html">DOM Level 2 Event Model</a> and <a
        href="InternetExplorerEventModel.html">Internet Explorer Event Model</a> - have more functionality, they can only be run on standards-compliant browsers and Internet Explorer respectively. Using advanced event models to handle events will need more consideration for cross-browser issues.<br>
      <br>
      Using the object detection is the basic start point. For example, when registering the <span
        class="courier">click</span> event, dealing with the difference between <span
        class="courier">addEventListener</span> and <span class="courier">attachEvent</span> can be as follow: <br>
      <div class="courier" style="margin-left: 40px;"><span><strong>if(element.addEventListener) {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; element.addEventListener('click', handler, false);</strong></span><span><strong><br>
          </strong></span><span><strong>}</strong></span><span><strong><br>
          </strong></span><span><strong>else if(element.attachEvent) {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; element.attachEvent('onclick', handler);</strong></span><span><strong><br>
          </strong></span><span><strong>}</strong></span><strong><br>
        </strong></div>
      <br>
      Internet Explorer doesn't support the capturing phase, so we have to abandon the usage of capturing events. Writing the above code repeatedly when we need to register an event is not only a troublesome matter, but also performance consumption due to repeated object detection. We can do the object detection when a browser loads scripts and create a function to encapsulate the real function used for registering an event. For example:&nbsp; <br>
      <div class="courier" style="margin-left: 40px;"><strong>var bind;</strong><strong><br>
        </strong><strong> </strong><strong><br>
        </strong><strong> function proxy(element, handler) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; return function() {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return handler.apply(element, arguments);</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong> }</strong><strong><br>
        </strong><strong> </strong><strong><br>
        </strong><strong> if(document.addEventListener) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="bold_red">element.addEventListener(eventType, proxy(element, handler), false);</span><br>
        <strong>&nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong> }</strong><strong><br>
        </strong><strong> else if(document.attachEvent) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="bold_red">element.attachEvent('on' + eventType, proxy(element, handler));</span><br>
        <strong>&nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong> }</strong></div>
      <br>
      The above example standardizes the way for registering an event and the event handler's <span
        class="courier">this</span> always refers to the element. We can bind an event as follows: <br>
      <div class="courier" style="margin-left: 40px;"> <span><strong>bind(somBtn, 'click', function() {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; var id = this.id;</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; ...</strong></span><span><strong><br>
          </strong></span><span><strong>});</strong></span></div>
      <br>
      Next, we'll consider unifying the way to retrieve the <span class="courier">Event</span> instance. If we'd like it be given from the first argument of the handler, we can write as follows: <br>
      <div class="courier" style="margin-left: 40px;"> <strong>var bind;</strong><strong><br>
        </strong><strong><br>
        </strong><strong>if(document.addEventListener) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; element.addEventListener(eventType, </strong><span
          class="bold_red">function(event) {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">return handler.call(event.currentTarget, event);</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="bold_red">}</span>, <strong>false);</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong>}</strong><strong><br>
        </strong><strong>else if(document.attachEvent) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; element.attachEvent('on' + eventType,</strong> <span
          class="bold_red">function() {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="courier bold_red">return handler.call(element, window.event);</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="bold_red">}</span><strong>);</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong>}</strong></div>
      <br>
      We can bind an event and get the <span class="courier">Event</span> instance from the first parameter as follows: <br>
      <div class="courier" style="margin-left: 40px;"> <span><strong>bind(somBtn, 'click', function(event) {</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; var id = this.id;</strong></span><span><strong><br>
          </strong></span><span><strong>&nbsp;&nbsp;&nbsp; ...</strong></span><span><strong><br>
          </strong></span><span><strong>});</strong></span><strong><br>
        </strong></div>
      <br>
      If we want to prevent the default action when the event handler returns <span
        class="courier">false</span>, we can rewrite as follows: <br>
      <div class="courier" style="margin-left: 40px;"> <strong>var bind;</strong><strong><br>
        </strong><strong><br>
        </strong><strong>if(document.addEventListener) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; element.addEventListener(eventType, </strong><span
          class="bold_red">function(event) {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="courier bold_red">var result = handler.call(event.currentTarget, event);</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">if(result === false) {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">event.preventDefault();</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">}</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">return result;</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="bold_red">}</span><strong>, false);</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong>}</strong><strong><br>
        </strong><strong>else if(document.attachEvent) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; element.attachEvent('on' + eventType, </strong><span
          class="bold_red">function() {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">var result = handler.call(element, window.event);</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">if(result === false) {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">window.event.returnValue = false;</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">}</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">return result;</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span class="bold_red">}</span><strong>);</strong><strong><br>
        </strong><strong>&nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong>}</strong></div>
      <br>
      Properties of an <span class="courier">Event</span> instance have cross-browser differences, such as target and <span
        class="courier">srcElement</span>, <span class="courier">stopPropagation</span> and <span
        class="courier">cancelBubble</span>, etc. We can create an object to unify those properties from an <span
        class="courier">Event</span> instance. For example:&nbsp; <br>
      <div class="courier" style="margin-left: 40px;"> <strong>var bind;</strong><strong><br>
        </strong><strong> </strong><strong><br>
        </strong><strong> if(document.addEventListener) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; element.addEventListener(eventType, function(event) {</strong><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">var evn = {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">// Copy properties</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">target : event.target,</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">currentTarget : event.currentTarget,</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">...</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">// Encapsulate functions</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">stopPropagation : function() {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">event.stopPropagation();</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">},</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">...</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">};</span><br>
        <br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>var result = handler.call(event.currentTarget, evn);</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(!result) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; event.preventDefault();</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return result;</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }, false);</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong> }</strong><strong><br>
        </strong><strong> else if(document.attachEvent) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; bind = function(element, eventType, handler) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; element.attachEvent('on' + eventType, function() {</strong><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">var evn = {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">// Copy properties</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">target : window.event.srcElement,</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">currentTarget : element,</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">...</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">// Encapsulate functions</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">stopPropagation : function() {</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">window.event.cancelBubble = true;</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">},</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">...</span><br>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span
          class="bold_red">};</span><br>
        <br>
        <strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; var result = handler.call(element, evn);</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if(result === false) {</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; window.event.returnValue = false;</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return result;</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; });</strong><strong><br>
        </strong><strong> &nbsp;&nbsp;&nbsp; };</strong><strong><br>
        </strong><strong> }<br>
        </strong></div>
      <br>
      The above examples demonstrate the basic concept for handling cross-browser events. You can take similar consideration while unbinding events. For more information about cross-browser event handling, you may take a look at <a
        href="http://msdn.microsoft.com/en-us/magazine/ff728624.aspx">Cross-Browser Event Handling Using Plain ole JavaScript</a>.<br>
      <br>
      <br>
      <p></p>
      <p></p>
      <ul>
      </ul>
    </div>
    <div class="aside">
      
       <br>
      <br>
      
       <br>
      <br>
      
       <br>
      <br>
      <br>
    </div>
      </body>
</html>
