<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html dir="ltr" lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Function Instances</title>
    <meta content="caterpillar" name="author">
    <meta content="JavaScript function instances" name="keywords">
    <link href="css/std.css" rel="stylesheet" type="text/css">
  </head>
  <body>
    <div class="header">
      <div class="hgroup">
        <h3><a href="http://openhome.cc/eGossip/">From eGossip@Openhome</a></h3>
        <h1><a href="index.html">JavaScript Essence: Function Instances<br>
          </a></h1>
      </div>
    </div>
    <div class="article">
      <div align="right"><a href="../../Gossip/JavaScript/FunctionInstance.html">中文</a><br>
      </div>
      <br>
      In JavaScript, a function is an instance of <span class="courier">Function</span> so you can assign it to a variable. For example:<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>js&gt; function max(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num1 &gt; num2 ? num1 : num2;<br>
                &nbsp; &gt; }<br>
                js&gt; var maximum = max;<br>
                js&gt; max(10, 20);</strong><br>
              20<br>
              <strong>js&gt; maximum(10, 20);</strong><br>
              20<br>
              <strong>js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      Take note of it, there's no <span class="courier">()</span> operator after the variable <span
        class="courier">max</span> while assigning it to <span class="courier">maximum</span>. This means the object refereed by <span
        class="courier">max</span> will be assigned to <span class="courier">maximum</span>. If there's a <span
        class="courier">()</span> after a variable, it means you want to call a function. Assign a function to a variable? If you feel this weird in the beginning, the following code may not look so: <br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>js&gt; var max = function(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num1 &gt; num2 ? num1 : num2;<br>
                &nbsp; &gt; };<br>
                js&gt; var maximum = max;<br>
                js&gt; max(1, 2);<br>
              </strong>2<strong><br>
                js&gt; maximum(1, 2);<br>
              </strong>2<strong><br>
                js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      In the above example, a function literal is used to create a function. Function literals are like number literals, array literals and object literals. They are respectively used to create functions, numbers, arrays and objects.<br>
      <blockquote><span class="courier"> <strong>var number = 10;</strong></span><strong><br>
          <span class="courier">var obj = { x : 10 };</span><br>
          <span class="courier">var array = [1, 2, 3];</span><br>
          <span class="courier">var func = function() {</span><br>
          <span class="courier">&nbsp;&nbsp;&nbsp; // do something...</span><br>
          <span class="courier">};</span><br>
        </strong></blockquote>
      A function literal creates an instance of <span class="courier">Function</span>. In JavaScript, no matter it's a function declaration or a function literal, both create an instance of <span
        class="courier">Function</span>. In fact, you can use the <span
        class="courier">Function</span> constructor to create a function directly.<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>js&gt; var max = new Function('num1', 'num2', 'return num1 &gt; num2 ? num1 : num2');<br>
                js&gt; max(5, 6);<br>
              </strong>6<strong><br>
                js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      Actually, JavaScript developers rarely use the <span class="courier">Function</span> constructor to create a function. The above example just shows that a function is really an instance of <span
        class="courier">Function</span>.<br>
      <br>
      Now that a function is an object, it can be arbitrarily assigned to other variables. It can also be passed as an argument to other functions. That is, it can be a callback function to other functions. For example:<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>js&gt; var printIt = function(element) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; print(element);<br>
                &nbsp; &gt; };<br>
                js&gt; [1, 2, 3].forEach(printIt);<br>
              </strong>1<br>
              2<br>
              3<strong><br>
                js&gt; var comparator = function(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num1 - num2;<br>
                &nbsp; &gt; };<br>
                js&gt; [5, 1, 7, 3, 2].sort(comparator);<br>
              </strong>1,2,3,5,7<strong><br>
                js&gt;</strong></td>
          </tr>
        </tbody>
      </table>
      <br>
      Take an <span class="courier">Array</span> instance for example. The <span
        class="courier">forEach</span> method iterates each array element to let you do something. You pass a function to <span
        class="courier">forEach</span>. Each array element will be passed in turns as an argument to the callback function.&nbsp; The <span
        class="courier">sort</span> method can sort array elements but has to know the order of any two elements. The function passed to <span
        class="courier">sort</span> should return a negative integer, zero, or a positive integer as the first argument is less than, equal to, or greater than the second.<br>
      <br>
      It's a common application to pass a function to a function in JavaScript. Actually, you can do as follows if you don't need a function name:<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>js&gt; [1, 2, 3].forEach(function(element) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; print(element);<br>
                &nbsp; &gt; });<br>
              </strong>1<br>
              2<br>
              3<strong><br>
                js&gt; [5, 1, 7, 3, 2].sort(function(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num1 - num2;<br>
                &nbsp; &gt; });<br>
              </strong>1,2,3,5,7<strong><br>
                js&gt;</strong><strong></strong></td>
          </tr>
        </tbody>
      </table>
      <br>
      You can also return a function from a function. The returned function usually creates a closure to bind some resource. I'll explain this afterword.&nbsp; <br>
      <br>
      &nbsp;<span class="courier">Function</span> instances created by function literals are often anonymous functions. You can execute a function even if it has no name.<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>js&gt; (function() {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; print('anonymous function...');<br>
                &nbsp; &gt; })();<br>
              </strong>anonymous function...<strong><br>
                js&gt;</strong><strong></strong><strong></strong></td>
          </tr>
        </tbody>
      </table>
      <br>
      In fact, function literals can have a name. For example:<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong></strong><strong></strong><strong></strong><strong>js&gt; var maximum = function max(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num1 &gt; num2 ? num1 : num2;<br>
                &nbsp; &gt; };<br>
                js&gt; maximum(10, 20);<br>
              </strong>20<strong><br>
                js&gt; max(10, 20);<br>
              </strong>js: "&lt;stdin&gt;", line 6: uncaught JavaScript runtime exception: ReferenceError: "max" is not defined.<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; at &lt;stdin&gt;:6<strong><br>
                <br>
                js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      It seems that <span class="courier">max</span> defined in the function literal is useless. Actually, the name of a function literal is suitable for a recursive context.<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong></strong><strong></strong><strong></strong><strong>js&gt; var gcd = function g(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num2 != 0 ? g(num2, num1 % num2) : num1;<br>
                &nbsp; &gt; };<br>
                js&gt; gcd(10, 5);<br>
              </strong>5<strong><br>
                js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      If an anonymous function wants to refer itself, it can use the <span
        class="courier">callee</span> property of <span class="courier">arguments</span>. For example:<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong></strong><strong></strong><strong></strong><strong>js&gt; var gcd = function(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num2 != 0 ? arguments.callee(num2, num1 % num2) : num1;<br>
                &nbsp; &gt; };<br>
                js&gt; gcd(20, 10);<br>
              </strong>10<strong><br>
                js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      Since a function is an object, it can own properties. For example, a function has a <span
        class="courier">length</span> property which represents the number of parameters:<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong></strong><strong></strong><strong></strong><strong>js&gt; var gcd = function g(num1, num2) {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; return num2 != 0 ? g(num2, num1 % num2) : num1;<br>
                &nbsp; &gt; };<br>
                js&gt; gcd.length;<br>
              </strong>2<strong><br>
                js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      A function can have methods, which will talk afterword. You can also add properties or methods on a function, like a plain object. <br>
      <br>
      Function declarations and function literals are almost the same but there are still some subtle differences. For example, if you write a f.js file as follows: <br>
      <ul>
        <li> f.js</li>
      </ul>
      <pre>func();
function func() {
    print('func');
} <br></pre>
      <br>
      Load it into Rhino interpreter. It will execute without error. <br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>&gt; java org.mozilla.javascript.tools.shell.Main f.js<br>
              </strong>func</td>
          </tr>
        </tbody>
      </table>
      <br>
      But if your f.js file is as follows:<br>
      <ul>
        <li> f.js</li>
      </ul>
      <pre>func();
var func = function() {
    print('func');
};<br></pre>
      <br>
      You will get the error message: <br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>&gt; java org.mozilla.javascript.tools.shell.Main f.js<br>
              </strong>js: uncaught JavaScript runtime exception: TypeError: func is not a function, it is undefined.<strong></strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      The error message tells you that <span class="courier">func</span> is <span
        class="courier">undefined</span>. The reason is, when an interpreter loads a js file, it first processes all declarations, including all variable and function declarations and then run the program. It's like that JavaScript hoists all declarations. You can image that all <span
        class="courier">var</span> and <span class="courier">function</span> declarations will be moved to the top of the enclosing scope. In the first f.js file, <span
        class="courier">func</span> is created by a function declaration so gets hoisted before the execution of the program starts.<br>
      <br>
      In the second f.js, the only one declaration is the variable <span
        class="courier">func</span>. After the interpreter hoists the variable <span
        class="courier">func</span>, it starts to execute the program. The variable <span
        class="courier">func</span> is available in the scope but <span
        class="courier"></span>has not yet been specified any value. It's <span
        class="courier">undefined</span> so the interpreter cannot finish the execution of the program. <br>
      <br>
      What deserves to be mentioned is function declarations and function literals both don't need to re-interpret the code when creating a function instance. But if you use the <span
        class="courier">Function</span> constructor to create a function, it's necessary to re-interpret the string arguments every time. <br>
      <blockquote><strong><span class="courier">var max = new Function('num1', 'num2', 'return num1 &gt; num2 ? num1 : num2');</span></strong><br>
      </blockquote>
      The name of a function declaration is actually a property of the scope object. For example, if a function is declared in the global scope:<br>
      <table class="cmd">
        <tbody>
          <tr>
            <td><strong>js&gt; function func() {<br>
                &nbsp; &gt;&nbsp;&nbsp;&nbsp;&nbsp; print('func');<br>
                &nbsp; &gt; }<br>
                js&gt; func();<br>
              </strong>func<strong><br>
                js&gt; this.func();<br>
              </strong>func<strong><br>
                js&gt;</strong><br>
            </td>
          </tr>
        </tbody>
      </table>
      <br>
      It can be seen that the name <span class="courier">func</span> is a property of the global object.<br>
      <br>
      <br>
      <p></p>
      <p></p>
      <ul>
      </ul>
    </div>
    <div class="aside">
      
       <br>
      <br>
      
       <br>
      <br>
      
       <br>
      <br>
      <br>
    </div>
      </body>
</html>
